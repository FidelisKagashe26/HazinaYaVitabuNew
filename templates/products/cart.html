{% extends "users/home.html" %}
{% load custom_filters %}
{% load i18n %}

{% block header %}
{% trans "Your Cart" %}
{% endblock %}

{% block main_block %}

<div class="text-center {% if theme == 'dark' %}bg-gray-800{% else %}bg-blue-100{% endif %} mt-2 py-3 border-b-2 {% if theme == 'dark' %}border-gray-700{% else %}border-blue-700{% endif %}">
    <h1 class="text-xl md:text-2xl font-bold {% if theme == 'dark' %}text-white{% else %}text-blue-800{% endif %}">
        {% trans "Your Cart" %}
    </h1>
</div>

<!-- Cart items table -->
<div class="m-3 overflow-x-auto">
    <table class="min-w-full border table-auto {% if theme == 'dark' %}bg-gray-900 text-gray-100 shadow-md{% else %}bg-white text-gray-900 shadow-md{% endif %} rounded-lg">
        <thead class="{% if theme == 'dark' %}bg-gray-800 text-gray-200{% else %}bg-blue-50 text-blue-900{% endif %}">
            <tr class="border-b">
                <th class="px-4 py-3 text-left">{% trans "Product" %}</th>
                <th class="px-4 py-3 text-left">{% trans "Name" %}</th>
                <th class="px-4 py-3 text-center">{% trans "Quantity" %}</th>
                <th class="px-4 py-3 text-right">{% trans "Price" %}</th>
                <th class="px-4 py-3 text-right">{% trans "Total" %}</th>
                <th class="px-4 py-3 text-right">{% trans "Action" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for item in cart_items %}
            <tr class="border-b hover:{% if theme == 'dark' %}bg-gray-800{% else %}bg-blue-50{% endif %} transition">
                <!-- Product image -->
                <td class="px-4 py-3 text-center align-middle">
                    {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="object-cover w-16 h-16 mx-auto rounded">
                    {% else %}
                        <span class="inline-block w-16 h-16 bg-gray-200 rounded"></span>
                    {% endif %}
                </td>

                <!-- Product name -->
                <td class="px-4 py-3 align-middle">
                    <h2 class="font-semibold">{{ item.product.name }}</h2>
                </td>

                <!-- Quantity -->
                <td class="px-4 py-3 text-center align-middle">
                    <form method="post" action="{% url 'update_cart' item.product.id %}">
                        {% csrf_token %}
                        <input type="number" name="quantity" value="{{ item.quantity }}" min="1" class="w-16 focus:outline-none focus:ring-2 focus:ring-blue-500 border rounded text-center {% if theme == 'dark' %}bg-gray-800 text-gray-100 border-gray-700{% else %}bg-white text-gray-900{% endif %}">
                        <button type="submit" class="ml-2 {% if theme == 'dark' %}text-blue-300 hover:text-blue-100{% else %}text-blue-500 hover:text-blue-700{% endif %}">
                            {% trans "Update" %}
                        </button>
                    </form>
                </td>

                <!-- Unit price -->
                <td class="px-4 py-3 text-right align-middle">
                    {{ item.product.price|format_currency }}
                </td>

                <!-- Item total -->
                <td class="px-4 py-3 text-right align-middle">
                    {{ item.total_price|format_currency }}
                </td>

                <!-- Remove -->
                <td class="px-4 py-3 text-right align-middle">
                    <form method="post" action="{% url 'remove_from_cart' item.id %}">
                        {% csrf_token %}
                        <button type="submit" class="{% if theme == 'dark' %}text-red-400 hover:text-red-200{% else %}text-red-500 hover:text-red-700{% endif %}">
                            {% trans "Remove" %}
                        </button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="px-4 py-4 text-center text-gray-500">{% trans "Your cart is empty." %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Total summary -->
<div class="mt-6 text-right {% if theme == 'dark' %}bg-gray-800 text-gray-100{% else %}bg-white text-gray-900{% endif %} p-4 shadow rounded-lg">
    <h3 class="font-semibold text-xl">{% trans "Total:" %} {{ total_sum|format_currency }}</h3>
</div>

<!-- Action buttons -->
<div class="m-6 flex justify-between space-x-4">
    <a href="{% url 'shop' %}" class="{% if theme == 'dark' %}bg-gray-700 text-gray-200 hover:bg-gray-600{% else %}bg-gray-300 text-gray-800 hover:bg-gray-400{% endif %} py-2 px-4 rounded">
        {% trans "Continue Shopping" %}
    </a>
    <a href="{% url 'checkout' %}" class="{% if theme == 'dark' %}bg-blue-600 text-white hover:bg-blue-500{% else %}bg-blue-600 text-white hover:bg-blue-500{% endif %} py-2 px-4 rounded">
        {% trans "Proceed to Checkout" %}
    </a>
</div>

{% endblock %}
